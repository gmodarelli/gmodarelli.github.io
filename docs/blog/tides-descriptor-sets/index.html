<!doctype html><html lang=en><head><meta charset=UTF-8><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://gmodarelli.com name=base><title>
Giuseppe Modarelli • Descriptor Sets Management</title><link title="Giuseppe Modarelli - Atom Feed" href=https://gmodarelli.com/atom.xml rel=alternate type=application/atom+xml><link href="https://gmodarelli.com/custom_subset.css?h=ffa90bf9a2649dfbcdbd" rel=stylesheet><link href="https://gmodarelli.com/main.css?h=6b1dda977391dad0c76e" rel=stylesheet><link href="https://gmodarelli.com/skins/blue.css?h=a4dc1e94d3f5759784d2" rel=stylesheet><meta content="light dark" name=color-scheme><meta content="How we manage descriptor sets for Tides of Revival" name=description><meta content="How we manage descriptor sets for Tides of Revival" property=og:description><meta content="Descriptor Sets Management" property=og:title><meta content=article property=og:type><meta content=en_GB property=og:locale><meta content=https://gmodarelli.com/blog/tides-descriptor-sets/ property=og:url><meta content="Giuseppe Modarelli" property=og:site_name><noscript><link href=https://gmodarelli.com/no_js.css rel=stylesheet></noscript><script src=https://gmodarelli.com/js/initializeTheme.min.js></script><script defer src=https://gmodarelli.com/js/themeSwitcher.min.js></script><script async data-goatcounter=https://gmodarelli.goatcounter.com/count src=https://gc.zgo.at/count.js></script><script src="https://gmodarelli.com/js/searchElasticlunr.min.js?h=b6d784e207d8794b3e43" defer></script><body class=use-sans-serif><header><nav class=navbar><div class=nav-title><a class=home-title href=https://gmodarelli.com>Giuseppe Modarelli</a></div><div class=nav-navs><ul><li><a class="nav-links no-hover-padding" href=https://gmodarelli.com/blog/>blog </a><li><a class="nav-links no-hover-padding" href=https://gmodarelli.com/archive/>archive </a><li><a class="nav-links no-hover-padding" href=https://gmodarelli.com/tags/>tags </a><li><a class="nav-links no-hover-padding" href="https://gmodarelli.com/uploads/Giuseppe Modarelli - Resume.pdf">CV </a><li class=menu-icons-container><ul class=menu-icons-group><li class="js menu-icon"><div aria-label="Click or press $SHORTCUT to open search" class="search-icon interactive-icon" title="Click or press $SHORTCUT to open search" id=search-button role=button tabindex=0><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z"/></svg></div><li class="theme-switcher-wrapper js"><div aria-label="Toggle dark mode" title="Toggle dark/light mode" aria-pressed=false class=theme-switcher role=button tabindex=0></div><div aria-label="Reset mode to default" class="theme-resetter arrow" title="Reset mode to default" aria-hidden=true role=button tabindex=0></div></ul></ul></div></nav></header><div class=content><main><article><h1 class=article-title>Descriptor Sets Management</h1><ul class=meta><span class="hidden p-author h-card"> <a title="Giuseppe Modarelli" class=u-url href=https://gmodarelli.com rel=author>Giuseppe Modarelli</a> </span><li>2nd Jun 2025<li title="533 words"><span aria-hidden=true class=separator>•</span>3 min read<li class=tag><span aria-hidden=true class=separator>•</span>Tags: <li class=tag><a href=https://gmodarelli.com/tags/directx-12/>DirectX 12</a>, <li class=tag><a href=https://gmodarelli.com/tags/graphics-programming/>graphics programming</a>, <li class=tag><a href=https://gmodarelli.com/tags/tides-of-revival/>Tides of Revival</a></ul><section class=body><p>The DirectX 12 renderer for <a href=https://github.com/Srekel/tides-of-revival>Tides of Revival</a> relies on bindless and HLSL 6.6 Dynamic Resources for almost all GPU resources. Still, there are some resources that need to be bound to shaders. For those, we have to use descriptors.<p>Tides renderer is written on top of a custom fork of <a href=https://github.com/gmodarelli/The-Forge/tree/ze-forge>The-Forge</a>, so we didn’t have to write our own heaps and descriptor handles management code (among many other things), and could instead focus on building a GPU abstraction layer tailored to the needs of Tides of Revival.<p><em>I’ll talk about why and how we use The-Forge in a future post, so stay tuned!</em><p>I wanted to build a thin GPU-resource binding abstraction layer that would satisfy two main goals:<ul><li>Make it easy to bind resources (textures, buffers, samplers, etc.) without having to deal with lower-level descriptors and descriptor sets data structures<li>Make the HLSL code the place where we declare resources, without having to duplicate their declarations in <code>zig</code></ul><p>To achieve both goals I extended The-Forge’s shader compilation pipeline. HLSL shaders are first compiled offline via <code>DXC</code> and their blobs are loaded during application startup.<p>After a shader blob is succesfully loaded, a list of <code>ShaderReflectionDescriptor</code>s is generated from each <code>D3D12_SHADER_DESC.BoundResources</code>. You can find the full source code on <a href=https://github.com/gmodarelli/The-Forge/blob/ze-forge/Common_3/Graphics/Direct3D12/Direct3D12_cxx.cpp#L133>Github</a>, but here is what the struct looks like:<pre class="language-C z-code" data-lang=C><code class=language-C data-lang=C><span class="z-source z-c"><span class="z-storage z-type z-c">typedef</span> <span class="z-storage z-type z-c">struct</span> ShaderReflectionDescriptor
</span><span class="z-source z-c"><span class="z-meta z-block z-c"><span class="z-punctuation z-section z-block z-begin z-c">{</span>
</span></span><span class="z-source z-c"><span class="z-meta z-block z-c">    <span class="z-storage z-modifier z-c">const</span> <span class="z-storage z-type z-c">char</span> Name<span class="z-meta z-brackets z-c"><span class="z-punctuation z-section z-brackets z-begin z-c">[</span><span class="z-constant z-numeric z-integer z-decimal z-c">32</span><span class="z-punctuation z-section z-brackets z-end z-c">]</span></span><span class="z-punctuation z-terminator z-c">;</span>            <span class="z-comment z-line z-double-slash z-c"><span class="z-punctuation z-definition z-comment z-c">//</span> Resource identifier used as binding key from higher-level APIs
</span></span></span><span class="z-source z-c"><span class="z-meta z-block z-c">    D3D_SHADER_INPUT_TYPE Type<span class="z-punctuation z-terminator z-c">;</span>     <span class="z-comment z-line z-double-slash z-c"><span class="z-punctuation z-definition z-comment z-c">//</span> The fields from the `D3D12_SHADER_INPUT_BIND_DESC` struct.
</span></span></span><span class="z-source z-c"><span class="z-meta z-block z-c">    D3D_SRV_DIMENSION Dimension<span class="z-punctuation z-terminator z-c">;</span>
</span></span><span class="z-source z-c"><span class="z-meta z-block z-c">    <span class="z-support z-type z-stdint z-c">uint32_t</span> BindPoint<span class="z-punctuation z-terminator z-c">;</span>
</span></span><span class="z-source z-c"><span class="z-meta z-block z-c">    <span class="z-support z-type z-stdint z-c">uint32_t</span> BindCount<span class="z-punctuation z-terminator z-c">;</span>
</span></span><span class="z-source z-c"><span class="z-meta z-block z-c">    <span class="z-support z-type z-stdint z-c">uint32_t</span> Space<span class="z-punctuation z-terminator z-c">;</span>
</span></span><span class="z-source z-c"><span class="z-meta z-block z-c"><span class="z-punctuation z-section z-block z-end z-c">}</span></span> ShaderReflectionDescriptor
</span></code></pre><p>The list of <code>ShaderReflectionDescriptor</code>s is then processed to generate <code>Descriptor</code>s that get associated to one of 4 <code>DescriptorSet</code>s. The full source code is available <a href=https://github.com/gmodarelli/The-Forge/blob/ze-forge/Common_3/Graphics/Direct3D12/Direct3D12.c#L4448>here</a>, but here’s the gist of what’s going on with a real example from a gaussian blur shader we’re using on the game.<p>Any given shader can declare resources that belong to one of 4 “spaces”, where each space has a different update frequency (per-draw, per-pass, per-frame and persistent).<pre class="language-HLSL z-code" data-lang=HLSL><code class=language-HLSL data-lang=HLSL><span class="z-text z-plain">
</span><span class="z-text z-plain">struct BlurData { ... };
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">cbuffer g_CBO : register(b0, SPACE_PerFrame)
</span><span class="z-text z-plain">{
</span><span class="z-text z-plain">    BlurData g_blur_data;
</span><span class="z-text z-plain">};
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">Texture2D&LTfloat4> g_input : register(t0, SPACE_Persistent);
</span><span class="z-text z-plain">RWTexture2D&LTfloat4> g_output : register(u1, SPACE_Persistent);
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">// Rest of the shader
</span></code></pre><p>This HLSL code will generate 1 per-frame and 1 persistent <code>DescriptorSet</code>s. The first set will contain a single <code>Descriptor</code> for a constant buffer named <code>g_CBO</code>, the second will contain two <code>Descriptor</code>s, one for a read-only 2D texture named <code>g_input</code> and one for a read-write 2D texture named <code>g_output</code>.<p>From <code>zig</code> we can then associate GPU resources handles to descriptors in descriptor sets.<p><strong>NOTE</strong>: <em>This code is part of the graphics (gfx) abstraction layer and there are data types and APIs that are still work in progress. I might write about in the future.</em><pre class="language-ZIG z-code" data-lang=ZIG><code class=language-ZIG data-lang=ZIG><span class="z-source z-zig"><span class="z-comment z-line z-zig">// Per-frame descriptors
</span></span><span class="z-source z-zig"><span class="z-keyword z-control z-zig">for</span> <span class="z-punctuation z-section z-parens z-begin z-zig">(</span>0<span class="z-keyword z-operator z-other z-zig">..</span>zf.frames_in_flight_count<span class="z-punctuation z-section z-parens z-end z-zig">)</span> <span class="z-keyword z-operator z-bitwise z-zig">|</span>frame_index<span class="z-keyword z-operator z-bitwise z-zig">|</span> <span class="z-punctuation z-section z-braces z-begin z-zig">{</span>
</span><span class="z-source z-zig">    <span class="z-storage z-modifier z-zig">const</span> resource_binding_descs <span class="z-keyword z-operator z-assignment z-zig">=</span> [<span class="z-constant z-numeric z-integer z-zig">_</span>]<span class="z-storage z-type z-zig">zf.ResourceBindingDesc</span><span class="z-punctuation z-section z-braces z-begin z-zig">{</span>
</span><span class="z-source z-zig">        .<span class="z-punctuation z-section z-braces z-begin z-zig">{</span>
</span><span class="z-source z-zig">            .name <span class="z-keyword z-operator z-assignment z-zig">=</span> <span class="z-string z-quoted z-double z-zig">"g_CBO"</span><span class="z-punctuation z-separator z-zig">,</span>
</span><span class="z-source z-zig">            .binding_type <span class="z-keyword z-operator z-assignment z-zig">=</span><span class="z-constant z-language z-enum"> .buffer</span><span class="z-punctuation z-separator z-zig">,</span>
</span><span class="z-source z-zig">            .buffer_handle <span class="z-keyword z-operator z-assignment z-zig">=</span> gfx.gauss_blur_constant_buffers[frame_index]<span class="z-punctuation z-separator z-zig">,</span>
</span><span class="z-source z-zig">        <span class="z-punctuation z-section z-braces z-end z-zig">}</span><span class="z-punctuation z-separator z-zig">,</span>
</span><span class="z-source z-zig">    <span class="z-punctuation z-section z-braces z-end z-zig">}</span><span class="z-punctuation z-terminator z-zig">;</span>
</span><span class="z-source z-zig">
</span><span class="z-source z-zig">    zf.<span class="z-variable z-function z-zig">updateDescriptorSet</span><span class="z-punctuation z-section z-parens z-begin z-zig">(</span>
</span><span class="z-source z-zig">        <span class="z-keyword z-operator z-bitwise z-zig">&</span>resource_binding_descs<span class="z-punctuation z-separator z-zig">,</span>
</span><span class="z-source z-zig"><span class="z-constant z-language z-enum">        .per_frame</span><span class="z-punctuation z-separator z-zig">,</span>
</span><span class="z-source z-zig">        <span class="z-support z-function z-zig">@intCast</span><span class="z-punctuation z-section z-parens z-begin z-zig">(</span>frame_index<span class="z-punctuation z-section z-parens z-end z-zig">)</span><span class="z-punctuation z-separator z-zig">,</span>
</span><span class="z-source z-zig">        gfx.gauss_blur_vertical_shader<span class="z-punctuation z-separator z-zig">,</span>
</span><span class="z-source z-zig">        gfx.gauss_blur_vertical_material.passes[<span class="z-constant z-numeric z-integer z-zig">0</span>].per_frame_descriptor_set
</span><span class="z-source z-zig">    <span class="z-punctuation z-section z-parens z-end z-zig">)</span><span class="z-punctuation z-terminator z-zig">;</span>
</span><span class="z-source z-zig"><span class="z-punctuation z-section z-braces z-end z-zig">}</span>
</span><span class="z-source z-zig">
</span><span class="z-source z-zig"><span class="z-comment z-line z-zig">// Persistent descriptors
</span></span><span class="z-source z-zig"><span class="z-punctuation z-section z-braces z-begin z-zig">{</span>
</span><span class="z-source z-zig">    <span class="z-storage z-modifier z-zig">const</span> resource_binding_descs <span class="z-keyword z-operator z-assignment z-zig">=</span> [<span class="z-constant z-numeric z-integer z-zig">_</span>]<span class="z-storage z-type z-zig">zf.ResourceBindingDesc</span><span class="z-punctuation z-section z-braces z-begin z-zig">{</span>
</span><span class="z-source z-zig">        .<span class="z-punctuation z-section z-braces z-begin z-zig">{</span>
</span><span class="z-source z-zig">            .name <span class="z-keyword z-operator z-assignment z-zig">=</span> <span class="z-string z-quoted z-double z-zig">"g_input"</span><span class="z-punctuation z-separator z-zig">,</span>
</span><span class="z-source z-zig">            .binding_type <span class="z-keyword z-operator z-assignment z-zig">=</span><span class="z-constant z-language z-enum"> .render_target</span><span class="z-punctuation z-separator z-zig">,</span>
</span><span class="z-source z-zig">            .render_target_handle <span class="z-keyword z-operator z-assignment z-zig">=</span> gfx.gbuffer0<span class="z-punctuation z-separator z-zig">,</span>
</span><span class="z-source z-zig">        <span class="z-punctuation z-section z-braces z-end z-zig">}</span><span class="z-punctuation z-separator z-zig">,</span>
</span><span class="z-source z-zig">        .<span class="z-punctuation z-section z-braces z-begin z-zig">{</span>
</span><span class="z-source z-zig">            .name <span class="z-keyword z-operator z-assignment z-zig">=</span> <span class="z-string z-quoted z-double z-zig">"g_output"</span><span class="z-punctuation z-separator z-zig">,</span>
</span><span class="z-source z-zig">            .binding_type <span class="z-keyword z-operator z-assignment z-zig">=</span><span class="z-constant z-language z-enum"> .render_texture</span><span class="z-punctuation z-separator z-zig">,</span>
</span><span class="z-source z-zig">            .render_texture_handle <span class="z-keyword z-operator z-assignment z-zig">=</span> gfx.gauss_blur_a<span class="z-punctuation z-separator z-zig">,</span>
</span><span class="z-source z-zig">        <span class="z-punctuation z-section z-braces z-end z-zig">}</span><span class="z-punctuation z-separator z-zig">,</span>
</span><span class="z-source z-zig">    <span class="z-punctuation z-section z-braces z-end z-zig">}</span><span class="z-punctuation z-terminator z-zig">;</span>
</span><span class="z-source z-zig">
</span><span class="z-source z-zig">    zf.<span class="z-variable z-function z-zig">updateDescriptorSet</span><span class="z-punctuation z-section z-parens z-begin z-zig">(</span>
</span><span class="z-source z-zig">        <span class="z-keyword z-operator z-bitwise z-zig">&</span>resource_binding_descs<span class="z-punctuation z-separator z-zig">,</span>
</span><span class="z-source z-zig"><span class="z-constant z-language z-enum">        .persistent</span><span class="z-punctuation z-separator z-zig">,</span>
</span><span class="z-source z-zig">        <span class="z-constant z-numeric z-integer z-zig">0</span><span class="z-punctuation z-separator z-zig">,</span>
</span><span class="z-source z-zig">        gfx.gauss_blur_horizontal_shader<span class="z-punctuation z-separator z-zig">,</span>
</span><span class="z-source z-zig">        gfx.gauss_blur_horizontal_material.passes[<span class="z-constant z-numeric z-integer z-zig">0</span>].persistent_descriptor_set
</span><span class="z-source z-zig">    <span class="z-punctuation z-section z-parens z-end z-zig">)</span><span class="z-punctuation z-terminator z-zig">;</span>
</span><span class="z-source z-zig"><span class="z-punctuation z-section z-braces z-end z-zig">}</span>
</span></code></pre><p>There is still a bit of duplication since if you rename a resource in a shader, you need to update the binding code on <code>zig</code> as well. But my plan is to use as few shaders as possbile for the game, so the need for more complex solutions (like code-gen or a more data-driven approach) is not needed just yet.<p>If you’re interested in graphics programming and what to chat about the renderer of Tides of Revival, you can find me on our <a href=https://discord.gg/t2SUa4ng>Discord Server</a>.</section></article></main><span class=hidden id=copy-success> Copied! </span><span class=hidden id=copy-init> Copy code to clipboard </span><script defer src=https://gmodarelli.com/js/copyCodeToClipboard.min.js></script></div><footer><section><nav class="socials nav-navs"><ul><li><a class="nav-links no-hover-padding social" href=https://gmodarelli.com/atom.xml> <img alt=feed loading=lazy src=https://gmodarelli.com/social_icons/rss.svg title=feed> </a><li><a class="nav-links no-hover-padding social" rel=" me" href=mailto:hello@gmodarelli> <img alt=email loading=lazy src=https://gmodarelli.com/social_icons/email.svg title=email> </a><li><a class="nav-links no-hover-padding social" rel=" me" href=https://github.com/gmodarelli/> <img alt=github loading=lazy src=https://gmodarelli.com/social_icons/github.svg title=github> </a><li><a class="nav-links no-hover-padding social" rel=" me" href=https://bsky.app/profile/gmodarelli.com> <img alt=bluesky loading=lazy src=https://gmodarelli.com/social_icons/bluesky.svg title=bluesky> </a><li><a class="nav-links no-hover-padding social" rel=" me" href=https://www.linkedin.com/in/gmodarelli/> <img alt=linkedin loading=lazy src=https://gmodarelli.com/social_icons/linkedin.svg title=linkedin> </a></ul></nav><nav class=nav-navs></nav><div class=credits><small> <p><p>Giuseppe Modarelli © 2025 Giuseppe Modarelli • Unless otherwise noted, the content in this website is available under the <a href=https://creativecommons.org/licenses/by-sa/4.0/>CC BY-SA 4.0</a> license.</p> Powered by <a href=https://www.getzola.org>Zola</a> & <a href=https://github.com/welpo/tabi>tabi</a> </small></div></section><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><h1 class=visually-hidden id=modalTitle>Search</h1><div id=modal-content><div id=searchBar><div aria-hidden=true class=search-icon><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z"/></svg></div><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search… role=combobox spellcheck=false><div class="close-icon interactive-icon" title="Clear search" id=clear-search role=button tabindex=0><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></div></div><div id=results-container><div id=results-info><span id=zero_results> No results</span><span id=one_results> $NUMBER result</span><span id=many_results> $NUMBER results</span><span id=two_results> $NUMBER results</span><span id=few_results> $NUMBER results</span></div><div id=results role=listbox></div></div></div></div></footer>